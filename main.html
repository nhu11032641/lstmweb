<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <h2 style="margin-top: 15px;">Vegetable Carbon Emission Alert</h2>
        <!-- <select class="form-select" aria-label="Default select example" style="margin-top: 10px;" id="select">
            <option value="" id="option"></option> 
        </select> -->
        <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example" id="select"
            style="margin-top: 15px;">

        </select>
        <button class="btn btn-primary" type="button" id="btn" style="margin-top: 10px;">Inquire</button>
        <button class="btn btn-primary" type="button" id="btn2" style="margin-top: 10px;">Data Processing</button>
        <button class="btn btn-primary" type="button" id="btn3" style="margin-top: 10px;">Data Cutting</button>
        <button class="btn btn-primary" type="button" id="btn4" style="margin-top: 10px;">Training</button>
        <a class="btn btn-primary" type="button" id="btn5" style="margin-top: 10px;"
            href="https://nhu11032641.github.io/lstmweb/main.html">Home</a>
        <button class="btn btn-primary" type="button" id="btn6" style="margin-top: 10px;" href="">Exit</button>
        <div id="t1">
            <table class="table table-bordered" style="margin-top: 10px;">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Product</th>
                        <th>High price</th>
                        <th>Middle price</th>
                        <th>Low price</th>
                        <th>Average price</th>
                        <th>Comparison with Previous Day</th>
                        <th>Trading Volume(kg)</th>
                        <!-- <th>跟前一交易日比較%</th> -->
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="one"></td>
                        <td id="two"></td>
                        <td id="three"></td>
                        <td id="four"></td>
                        <td id="five"></td>
                        <td id="six"></td>
                        <td id="seven"></td>
                        <td id="eight"></td>
                        <!-- <td id="nine"></td> -->
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="t2">
            <div class="input-group input-group-lg" style="margin-top: 10px;">
                <span class="input-group-text" id="inputGroup-sizing-lg">Enter forecast days</span>
                <input type="text" class="form-control" aria-label="Sizing example input"
                    aria-describedby="inputGroup-sizing-lg" id="day">
            </div>
            <h2 id="th1" style="margin-top: 10px;">Train Data</h2>
            <table class="table table-bordered" style="margin-top: 10px;">
                <thead>
                    <tr>
                        <th>highest price</th>
                        <th>median price</th>
                        <th>lowest price</th>
                        <th>average price</th>
                        <th>volume</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="trainone"></td>
                        <td id="traintwo"></td>
                        <td id="trainthree"></td>
                        <td id="trainfour"></td>
                        <td id="trainfive"></td>
                    </tr>
                </tbody>
            </table>
            <h2 id="th2" style="margin-top: 10px;">Test Data</h2>
            <table class="table table-bordered" style="margin-top: 10px;">
                <thead>
                    <tr>
                        <th>highest price</th>
                        <th>median price</th>
                        <th>lowest price</th>
                        <th>average price</th>
                        <th>volume</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="testone"></td>
                        <td id="testtwo"></td>
                        <td id="testthree"></td>
                        <td id="testfour"></td>
                        <td id="testfive"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="t3">
            <h2 id="th21" style="margin-top: 10px;">Train Data</h2>
            <table class="table table-bordered" style="margin-top: 10px;">
                <thead>
                    <tr>
                        <th>highest price</th>
                        <th>median price</th>
                        <th>lowest price</th>
                        <th>average price</th>
                        <th>volume</th>
                        <th>volume after 14 days</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="splittrainone"></td>
                        <td id="splittraintwo"></td>
                        <td id="splittrainthree"></td>
                        <td id="splittrainfour"></td>
                        <td id="splittrainfive"></td>
                        <td id="splittrainsix"></td>
                    </tr>
                </tbody>
            </table>
            <h2 id="th22" style="margin-top: 10px;">Test Data</h2>
            <table class="table table-bordered" style="margin-top: 10px;">
                <thead>
                    <tr>
                        <th>highest price</th>
                        <th>median price</th>
                        <th>lowest price</th>
                        <th>average price</th>
                        <th>volume</th>
                        <th>volume after days</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="splittestone"></td>
                        <td id="splittesttwo"></td>
                        <td id="splittestthree"></td>
                        <td id="splittestfour"></td>
                        <td id="splittestfive"></td>
                        <td id="splittestsix"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="t4">
            <img id="frame">
            <h2 id="loss"></h2>
            <img id="frame2"><br>
            <img id="frame3"><br>
            <img id="frame4"><br>
            <div id="t5">
                <table class="table table-bordered" style="margin-top: 10px;">
                    <thead>
                        <tr>
                            <th>co2</th>
                            <th>co2_avg</th>
                            <th>co2_std</th>
                            <th>co2_thr</th>
                            <th>co2_sta</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="co2one"></td>
                            <td id="co2two"></td>
                            <td id="co2three"></td>
                            <td id="co2four"></td>
                            <td id="co2five"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            document.getElementById('btn6').onclick = function () {
                if (window.confirm("Are you sure you want to close this web?")) {
                    window.opener = null;
                    window.open('', '_self');
                    window.close();
                }
            };
            $("#t2").hide()
            $("#t1").hide()
            $("#t3").hide()
            $("#t4").hide()
            $("#btn2").hide()
            $("#btn3").hide()
            $("#btn4").hide()
            var urlval = "https://077e1a710376.ngrok-free.app"
            var alldata = {};
            $.ajax({
                url: urlval + "/getproduct",
                method: "GET",
                headers: {
                    "ngrok-skip-browser-warning": "69420"
                },
                success: function (data) {
                    $.each(data, function (key, value) {
                        $("#select").append('<option value="' + value.detail + '">' + value.detail + '</option>');
                    });
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
            $("#btn").on("click", function () {
                $("#day").val("")
                $("#t2").hide()
                $("#t3").hide()
                $("#t4").hide()
                $("#one").html("")
                $("#two").html("")
                $("#three").html("")
                $("#four").html("")
                $("#five").html("")
                $("#six").html("")
                $("#seven").html("")
                $("#eight").html("")
                $(this).prop("disabled", true);
                $(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...')
                var selectedValue = $("#select").val();
                $.ajax({
                    url: urlval + "/getvalue?product=" + selectedValue,
                    method: "GET",
                    headers: {
                        "ngrok-skip-browser-warning": "69420"
                    },
                    success: function (data) {
                        alldata = data;
                        console.log(data['長度']);
                        if (data['長度'] < 15) {
                            for (var i = 0; i < data['長度']; i++) {
                                $("#one").append(data['日期'][i] + '<br>');
                                $("#two").append(data['產品'][i] + '<br>');
                                $("#three").append(data['上價'][i] + '<br>');
                                $("#four").append(data['中價'][i] + '<br>');
                                $("#five").append(data['下價'][i] + '<br>');
                                $("#six").append(data['平均價(元/公斤)'][i] + '<br>');
                                $("#seven").append(data['跟前一交易日比較%'][i] + '<br>');
                                $("#eight").append(data['交易量(公斤)'][i] + '<br>');
                            }
                        } else {
                            var getlen = data['長度'];
                            var arr = [0, 1, 2, 3, 4, 5, getlen - 5, getlen - 4, getlen - 3, getlen - 2, getlen - 1];
                            var item = 0;
                            arr.forEach(e => {
                                item += 1;
                                if (item == 6) {
                                    $("#one").append('...<br>');
                                    $("#two").append('...<br>');
                                    $("#three").append('...<br>');
                                    $("#four").append('...<br>');
                                    $("#five").append('...<br>');
                                    $("#six").append('...<br>');
                                    $("#seven").append('...<br>');
                                    $("#eight").append('...<br>');
                                } else {
                                    $("#one").append(data['日期'][e] + '<br>');
                                    $("#two").append(data['產品'][e] + '<br>');
                                    $("#three").append(data['上價'][e] + '<br>');
                                    $("#four").append(data['中價'][e] + '<br>');
                                    $("#five").append(data['下價'][e] + '<br>');
                                    $("#six").append(data['平均價(元/公斤)'][e] + '<br>');
                                    $("#seven").append(data['跟前一交易日比較%'][e] + '<br>');
                                    $("#eight").append(data['交易量(公斤)'][e] + '<br>');
                                }
                            });
                        }
                        $('#t1').show();
                        $('#btn2').show();
                        $('#btn4').hide();
                        $('#btn3').hide();
                        $('#btn').prop("disabled", false);
                        $('#btn').html('Inquire');
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            });
            $("#btn2").on("click", function () {
                $('#t1').hide()
                $('#t3').hide()
                $('#t4').hide()
                $("#trainone").html("")
                $("#traintwo").html("")
                $("#trainthree").html("")
                $("#trainfour").html("")
                $("#trainfive").html("")
                $("#testone").html("")
                $("#testtwo").html("")
                $("#testthree").html("")
                $("#testfour").html("")
                $("#testfive").html("")
                $(this).prop("disabled", true);
                $(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...')
                console.log(alldata)
                alldata['day'] = 0
                $.ajax({
                    type: 'POST',
                    url: urlval + "/postdata2",
                    data: JSON.stringify(alldata),
                    headers: {
                        "ngrok-skip-browser-warning": "69420"
                    },
                    success: function (response) {
                        console.log(response);
                        console.log(response.traindata['長度'])
                        console.log(response.testdata['長度'])
                        if (response.traindata['長度'] < 15) {
                            for (var i = 0; i < response.traindata['長度']; i++) {
                                $("#trainone").append(response.traindata['highest price'][i] + '<br>')
                                $("#traintwo").append(response.traindata['median price'][i] + '<br>')
                                $("#trainthree").append(response.traindata['lowest price'][i] + '<br>')
                                $("#trainfour").append(response.traindata['average price'][i] + '<br>')
                                $("#trainfive").append(response.traindata['volume'][i] + '<br>')
                            }
                        } else {
                            var getlen = response.traindata['長度']
                            var arr = [0, 1, 2, 3, 4, 5, getlen - 5, getlen - 4, getlen - 3, getlen - 2, getlen - 1]
                            var item = 0
                            arr.forEach(e => {
                                item += 1
                                if (item == 6) {
                                    $("#trainone").append('...<br>')
                                    $("#traintwo").append('...<br>')
                                    $("#trainthree").append('...<br>')
                                    $("#trainfour").append('...<br>')
                                    $("#trainfive").append('...<br>')
                                } else {
                                    $("#trainone").append(response.traindata['highest price'][e] + '<br>')
                                    $("#traintwo").append(response.traindata['median price'][e] + '<br>')
                                    $("#trainthree").append(response.traindata['lowest price'][e] + '<br>')
                                    $("#trainfour").append(response.traindata['average price'][e] + '<br>')
                                    $("#trainfive").append(response.traindata['volume'][e] + '<br>')
                                }
                            });
                        }
                        if (response.testdata['長度'] < 15) {
                            for (var i = 0; i < response.testdata['長度']; i++) {
                                $("#testone").append(response.testdata['highest price'][i] + '<br>')
                                $("#testtwo").append(response.testdata['median price'][i] + '<br>')
                                $("#testthree").append(response.testdata['lowest price'][i] + '<br>')
                                $("#testfour").append(response.testdata['average price'][i] + '<br>')
                                $("#testfive").append(response.testdata['volume'][i] + '<br>')
                            }
                        } else {
                            var getlen = response.testdata['長度']
                            var arr = [0, 1, 2, 3, 4, 5, getlen - 5, getlen - 4, getlen - 3, getlen - 2, getlen - 1]
                            var item = 0
                            arr.forEach(e => {
                                item += 1
                                if (item == 6) {
                                    $("#testone").append('...<br>')
                                    $("#testtwo").append('...<br>')
                                    $("#testthree").append('...<br>')
                                    $("#testfour").append('...<br>')
                                    $("#testfive").append('...<br>')
                                } else {
                                    $("#testone").append(response.testdata['highest price'][e] + '<br>')
                                    $("#testtwo").append(response.testdata['median price'][e] + '<br>')
                                    $("#testthree").append(response.testdata['lowest price'][e] + '<br>')
                                    $("#testfour").append(response.testdata['average price'][e] + '<br>')
                                    $("#testfive").append(response.testdata['volume'][e] + '<br>')
                                }
                            });
                        }
                        $('#t2').show()
                        $('#btn3').show()
                        $('#btn2').hide()
                        $('#th1').html("Train Data(共" + response.traindata['長度'] + "筆)")
                        $('#th2').html("Test Data(共" + response.testdata['長度'] + "筆)")
                        $('#btn2').prop("disabled", false);
                        $('#btn2').html('Data Processing');
                    },
                    dataType: 'json',
                    contentType: "application/json;charset=utf-8",
                });
            })
            $("#btn3").on("click", function () {
                $('#t1').hide()
                $('#t2').hide()
                $('#t4').hide()
                $("#splittrainone").html("")
                $("#splittraintwo").html("")
                $("#splittrainthree").html("")
                $("#splittrainfour").html("")
                $("#splittrainfive").html("")
                $("#splittrainsix").html("")
                $("#splittestone").html("")
                $("#splittesttwo").html("")
                $("#splittestthree").html("")
                $("#splittestfour").html("")
                $("#splittestfive").html("")
                $("#splittestsix").html("")
                if ($("#day").val() > 0) {
                    $(this).prop("disabled", true);
                    $(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Loading...')
                    alldata['day'] = $("#day").val()
                    $.ajax({
                        type: 'POST',
                        url: urlval + "/datadealwith",
                        data: JSON.stringify(alldata),
                        headers: {
                            "ngrok-skip-browser-warning": "69420"
                        },
                        success: function (response) {
                            console.log(response);
                            console.log(response.traindata['長度'])
                            console.log(response.testdata['長度'])
                            console.log(response.testdata['volumee after'][0])
                            if (response.traindata['長度'] < 15) {
                                for (var i = 0; i < response.traindata['長度']; i++) {
                                    $("#splittrainone").append(response.traindata['highest price'][i] + '<br>')
                                    $("#splittraintwo").append(response.traindata['median price'][i] + '<br>')
                                    $("#splittrainthree").append(response.traindata['lowest price'][i] + '<br>')
                                    $("#splittrainfour").append(response.traindata['average price'][i] + '<br>')
                                    $("#splittrainfive").append(response.traindata['volume'][i] + '<br>')
                                    $("#splittrainsix").append(response.traindata['volume after'][i] + '<br>')
                                }
                            } else {
                                var getlen = response.traindata['長度']
                                var arr = [0, 1, 2, 3, 4, 5, getlen - 5, getlen - 4, getlen - 3, getlen - 2, getlen - 1]
                                var item = 0
                                arr.forEach(e => {
                                    item += 1
                                    if (item == 6) {
                                        $("#splittrainone").append('...<br>')
                                        $("#splittraintwo").append('...<br>')
                                        $("#splittrainthree").append('...<br>')
                                        $("#splittrainfour").append('...<br>')
                                        $("#splittrainfive").append('...<br>')
                                        $("#splittrainsix").append('...<br>')
                                    } else {
                                        $("#splittrainone").append(response.traindata['highest price'][e] + '<br>')
                                        $("#splittraintwo").append(response.traindata['median price'][e] + '<br>')
                                        $("#splittrainthree").append(response.traindata['lowest price'][e] + '<br>')
                                        $("#splittrainfour").append(response.traindata['average price'][e] + '<br>')
                                        $("#splittrainfive").append(response.traindata['volume'][e] + '<br>')
                                        $("#splittrainsix").append(response.traindata['volume after'][e] + '<br>')
                                    }
                                });
                            }
                            if (response.testdata['長度'] < 15) {
                                for (var i = 0; i < response.testdata['長度']; i++) {
                                    $("#splittestone").append(response.testdata['highest price'][i] + '<br>')
                                    $("#splittesttwo").append(response.testdata['median price'][i] + '<br>')
                                    $("#splittestthree").append(response.testdata['lowest price'][i] + '<br>')
                                    $("#splittestfour").append(response.testdata['average price'][i] + '<br>')
                                    $("#splittestfive").append(response.testdata['volume'][i] + '<br>')
                                    $("#splittestsix").append(response.testdata['volumee after'][i] + '<br>')
                                }
                            } else {
                                var getlen = response.testdata['長度']
                                var arr = [0, 1, 2, 3, 4, 5, getlen - 5, getlen - 4, getlen - 3, getlen - 2, getlen - 1]
                                var item = 0
                                arr.forEach(e => {
                                    item += 1
                                    if (item == 6) {
                                        $("#splittestone").append('...<br>')
                                        $("#splittesttwo").append('...<br>')
                                        $("#splittestthree").append('...<br>')
                                        $("#splittestfour").append('...<br>')
                                        $("#splittestfive").append('...<br>')
                                        $("#splittestsix").append('...<br>')
                                    } else {
                                        $("#splittestone").append(response.testdata['highest price'][e] + '<br>')
                                        $("#splittesttwo").append(response.testdata['median price'][e] + '<br>')
                                        $("#splittestthree").append(response.testdata['lowest price'][e] + '<br>')
                                        $("#splittestfour").append(response.testdata['average price'][e] + '<br>')
                                        $("#splittestfive").append(response.testdata['volume'][e] + '<br>')
                                        $("#splittestsix").append(response.testdata['volumee after'][e] + '<br>')
                                    }
                                });
                            }
                            $('#t3').show()
                            $('#btn4').show()
                            $('#btn3').hide()
                            $('#th21').html("Train Data(共" + response.traindata['長度'] + "筆)")
                            $('#th22').html("Test Data(共" + response.testdata['長度'] + "筆)")
                            $('#btn3').prop("disabled", false);
                            $('#btn3').html('Data Cutting');
                        },
                        dataType: 'json',
                        contentType: "application/json;charset=utf-8",
                    });
                } else {
                    alert("The number of input days needs to be greater than 0")
                }
            })
            $("#btn4").on("click", function () {
                $('#t1').hide()
                $('#t2').hide()
                $('#t3').hide()
                if ($('#day').val() > 0) {
                    alldata['day'] = $("#day").val()
                    $(this).prop("disabled", true);
                    $(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Training...')
                    $.ajax({
                        type: 'POST',
                        url: urlval + "/train",
                        data: JSON.stringify(alldata),
                        headers: {
                            "ngrok-skip-browser-warning": "69420"
                        },
                        success: function (response) {
                            console.log(response);
                            //$("#getimg").attr("src", "data:image/png;base64," + response.image_data);
                            document.getElementById('frame').src = 'data:;base64,' + response['image'];
                            document.getElementById('frame2').src = 'data:;base64,' + response['image2'];
                            document.getElementById('frame3').src = 'data:;base64,' + response['image3'];
                            document.getElementById('frame4').src = 'data:;base64,' + response['image4'];
                            console.log(response['df']['長度'])
                            console.log(response['df']['co2'][1])
                            if (response['df']['長度'] < 15) {
                                for (var i = 0; i < response['df']['長度']; i++) {
                                    $("#co2one").append(response['df']['co2'][i] + '<br>');
                                    $("#co2two").append(response['df']['co2_avg'][i] + '<br>');
                                    $("#co2three").append(response['df']['co2_std'][i] + '<br>');
                                    $("#co2four").append(response['df']['co2_thr'][i] + '<br>');
                                    $("#co2five").append(response['df']['co2_sta'][i] + '<br>');
                                }
                            }
                            else {
                                var getlen = response['df']['長度'];
                                var arr = [0, 1, 2, 3, 4, 5, getlen - 5, getlen - 4, getlen - 3, getlen - 2, getlen - 1];
                                var item = 0;
                                arr.forEach(e => {
                                    item += 1;
                                    if (item == 6) {
                                        $("#co2one").append('...<br>');
                                        $("#co2two").append('...<br>');
                                        $("#co2three").append('...<br>');
                                        $("#co2four").append('...<br>');
                                        $("#co2five").append('...<br>');
                                    } else {
                                        $("#co2one").append(response['df']['co2'][e] + '<br>');
                                        $("#co2two").append(response['df']['co2_avg'][e] + '<br>');
                                        $("#co2three").append(response['df']['co2_std'][e] + '<br>');
                                        $("#co2four").append(response['df']['co2_thr'][e] + '<br>');
                                        $("#co2five").append(response['df']['co2_sta'][e] + '<br>');
                                    }
                                });
                            }
                            $("#loss").html(response['scorestrain'])
                            $('#btn4').prop("disabled", false);
                            $('#btn4').html('Training');
                            $('#t4').show()
                        },
                        dataType: 'json',
                        contentType: "application/json;charset=utf-8",
                    });
                }
            })
        })
    </script>
</body>

</html>
